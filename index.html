<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>OpenAnswer</title>
    <link rel="stylesheet" href="style.css">
    <style>
        @font-face {
            font-family: 'Chinese Font';
            src: local('PingFang SC'), local('Microsoft YaHei'), local('Hiragino Sans GB'), local('Heiti SC');
            font-weight: normal;
            font-style: normal;
        }
        body {
            font-family: 'Chinese Font', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        /* OCR进度指示器 */
        .progress-container {
            margin-top: 10px;
            background-color: #f0f0f0;
            border-radius: 4px;
            height: 8px;
            overflow: hidden;
            display: none;
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: #0d6efd;
            transition: width 0.3s ease;
        }
        
        /* 配置信息样式 */
        .config-info {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .config-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            background-color: #e9ecef;
            color: #495057;
        }
        
        .config-badge.llm {
            background-color: #cfe2ff;
            color: #0d6efd;
        }
        
        .config-badge.ocr {
            background-color: #d1e7dd;
            color: #198754;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="video-container">
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas" style="display: none;"></canvas>
            <div class="video-info">
                <p>请选择要共享的窗口，确保窗口中有清晰的文字内容</p>
                <p class="tips">提示：共享整个屏幕或应用窗口效果最佳，避免共享浏览器标签页</p>
            </div>
        </div>
        <div class="qa-container">
            <div id="status" class="status">
                <h3>状态：</h3>
                <p id="status-content">正在加载配置...</p>
                <div class="progress-container" id="progress-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                <div class="config-info">
                    <div class="config-badge llm" id="llm-badge">LLM: 加载中...</div>
                    <div class="config-badge ocr" id="ocr-badge">OCR: 加载中...</div>
                </div>
            </div>
            <div id="question" class="question">
                <h3>识别的问题：</h3>
                <p id="question-content"></p>
            </div>
            <div id="answer" class="answer">
                <h3>AI 回答：</h3>
                <p id="answer-content"></p>
            </div>
        </div>
    </div>
    <footer>
        <p>每 4 秒自动识别一次屏幕内容。如果答案未更新，请稍等片刻或调整窗口位置。</p>
        <p class="help-text">如遇问题：1) 确保文字清晰可见 2) 尝试调整窗口大小 3) 检查网络连接</p>
    </footer>
    <script src="https://unpkg.com/tesseract.js@v4.1.1/dist/tesseract.min.js"></script>
    <script>
        // 等待配置加载完成后再初始化应用
        window.onload = async function() {
            try {
                const response = await fetch('/config');
                if (!response.ok) {
                    throw new Error('配置加载失败');
                }
                window.API_CONFIG = await response.json();
                
                // 显示LLM模型信息
                const llmBadge = document.getElementById('llm-badge');
                if (llmBadge) {
                    const llmModel = window.API_CONFIG.llmModel || 'deepseek';
                    let modelName = llmModel === 'siliconflow' ? 'SiliconFlow' : 'DeepSeek';
                    
                    // 如果是SiliconFlow，显示具体的模型名称
                    if (llmModel === 'siliconflow' && window.API_CONFIG.siliconflowModel) {
                        // 提取更友好的模型名称
                        const modelParts = window.API_CONFIG.siliconflowModel.split('/');
                        if (modelParts.length > 0) {
                            const lastPart = modelParts[modelParts.length - 1];
                            modelName = `${modelName}: ${lastPart}`;
                        }
                    }
                    
                    llmBadge.textContent = `LLM: ${modelName}`;
                    llmBadge.title = `完整模型: ${window.API_CONFIG.siliconflowModel || 'deepseek-chat'}`;
                }
                
                // 显示OCR模式
                const ocrBadge = document.getElementById('ocr-badge');
                if (ocrBadge) {
                    const ocrMethod = window.API_CONFIG.ocrMethod || 'local';
                    ocrBadge.textContent = `OCR: ${ocrMethod === 'local' ? '本地识别' : '百度云识别'}`;
                }
                
                // 加载主应用脚本
                const script = document.createElement('script');
                script.src = 'script.js';
                document.body.appendChild(script);
            } catch (error) {
                console.error('Error loading config:', error);
                document.getElementById('status-content').textContent = '错误：无法加载 API 配置';
            }
        };
    </script>
</body>
</html> 