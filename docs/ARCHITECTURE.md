# OpenAnswer 系统架构

本文档描述了 OpenAnswer 智能解题助手的系统架构、组件关系和技术实现细节，帮助开发者理解系统设计和工作原理。

## 系统概述

OpenAnswer 是一个基于大语言模型的智能解题助手，能够实时捕获屏幕内容，识别问题文本，并通过大语言模型生成解答。系统采用前后端分离架构，前端负责用户界面和屏幕捕获，后端负责配置管理和 API 调用。

## 架构图

```
+------------------+     +------------------+     +------------------+
|                  |     |                  |     |                  |
|  用户界面 (UI)    +---->+  屏幕捕获/OCR    +---->+  大语言模型 (LLM) |
|                  |     |                  |     |                  |
+------------------+     +------------------+     +------------------+
         ^                       ^                        ^
         |                       |                        |
         v                       v                        v
+----------------------------------------------------------+
|                                                          |
|                      配置管理/服务器                       |
|                                                          |
+----------------------------------------------------------+
```

## 核心组件

### 1. 前端组件

#### 1.1 用户界面 (UI)

- **文件**: `index.html`, `app.js`, `ui.js`, `styles.css`
- **功能**: 提供用户交互界面，显示捕获的屏幕内容、识别结果和解答
- **技术**: HTML5, CSS3, JavaScript (原生)
- **主要模块**:
  - 屏幕捕获区域
  - 识别问题显示区域
  - 智能回答显示区域
  - 状态指示器

#### 1.2 屏幕捕获模块

- **文件**: `app.js`, `services/capture.js`
- **功能**: 使用 MediaDevices API 捕获用户选择的屏幕内容
- **技术**: MediaDevices API, Canvas API
- **主要流程**:
  1. 获取用户屏幕共享权限
  2. 定期捕获屏幕内容并转换为图像
  3. 将图像传递给 OCR 模块进行识别

#### 1.3 OCR 识别模块

- **文件**: `services/ocr.js`
- **功能**: 识别图像中的文字内容
- **技术**: Tesseract.js (本地识别), 百度云 OCR API (云端识别)
- **识别方式**:
  - 本地识别: 使用 Tesseract.js 在浏览器中进行识别
  - 百度云识别: 调用百度智能云 OCR API 进行识别

### 2. 后端组件

#### 2.1 服务器

- **文件**: `server.js`
- **功能**: 提供 API 接口，处理前端请求
- **技术**: Node.js, Express
- **主要接口**:
  - `/config`: 获取系统配置
  - `/api/llm`: 调用大语言模型 API

#### 2.2 配置管理

- **文件**: `config.js`
- **功能**: 管理系统配置，加载环境变量
- **技术**: dotenv
- **主要配置项**:
  - LLM 模型配置
  - OCR 方法配置
  - 系统参数配置

#### 2.3 LLM 调用模块

- **文件**: `services/llm.js`
- **功能**: 调用大语言模型 API，处理问题并生成回答
- **技术**: node-fetch
- **支持的模型**:
  - SiliconFlow API (支持多种模型)
  - DeepSeek API (支持 chat 和 reasoner 模型)

## 数据流

1. **屏幕捕获流程**:
   ```
   用户选择屏幕 -> MediaDevices API 捕获 -> Canvas 处理 -> 图像数据
   ```

2. **OCR 识别流程**:
   ```
   图像数据 -> OCR 服务 (本地/百度) -> 文本识别结果
   ```

3. **LLM 处理流程**:
   ```
   文本识别结果 -> LLM API 调用 -> 生成回答 -> 显示结果
   ```

## 技术栈详解

### 前端技术

- **HTML5/CSS3/JavaScript**: 构建用户界面和交互逻辑
- **MediaDevices API**: 实现屏幕捕获功能
- **Canvas API**: 处理捕获的屏幕内容
- **Tesseract.js**: 浏览器端 OCR 文字识别
- **Fetch API**: 与后端服务通信

### 后端技术

- **Node.js**: 服务器运行环境
- **Express**: Web 服务器框架
- **dotenv**: 环境变量管理
- **node-fetch**: 发起 HTTP 请求

## 扩展性设计

OpenAnswer 的架构设计考虑了系统的扩展性，主要体现在以下几个方面：

1. **模块化设计**: 系统各组件高度模块化，便于替换和扩展
2. **可配置性**: 通过环境变量和配置文件实现系统行为的灵活配置
3. **多模型支持**: LLM 模块设计支持多种大语言模型的接入
4. **多 OCR 方式**: OCR 模块支持多种识别方式，可根据需求切换

## 性能优化

系统在设计上考虑了性能优化，主要包括：

1. **图像压缩**: 在传输前对捕获的图像进行压缩，减少数据传输量
2. **节流处理**: 对屏幕捕获和 OCR 识别进行节流，避免频繁处理
3. **相似度检测**: 通过文本相似度检测避免重复处理相同的问题
4. **异步处理**: 使用异步方式处理 OCR 和 LLM 调用，提高响应速度

## 安全性考虑

系统在设计上考虑了安全性，主要包括：

1. **API 密钥保护**: 敏感的 API 密钥存储在服务器端，不暴露给前端
2. **环境变量隔离**: 使用 .env 文件存储敏感配置，不纳入版本控制
3. **输入验证**: 对用户输入和 API 参数进行验证，防止注入攻击
4. **错误处理**: 完善的错误处理机制，避免敏感信息泄露

## 未来扩展方向

1. **多语言支持**: 扩展 UI 和识别能力，支持更多语言
2. **离线模式**: 实现完全本地化的模型部署，支持离线使用
3. **用户认证**: 添加用户账户系统，支持个性化配置和历史记录
4. **更多 LLM 模型**: 接入更多大语言模型，提供更丰富的选择
5. **移动端支持**: 开发移动应用版本，支持在移动设备上使用

---

本文档将随着项目发展持续更新。如有任何问题或建议，请通过 GitHub Issues 联系我们。 